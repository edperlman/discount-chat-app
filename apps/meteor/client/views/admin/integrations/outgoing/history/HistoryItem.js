"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
const fuselage_1 = require("@rocket.chat/fuselage");
const fuselage_hooks_1 = require("@rocket.chat/fuselage-hooks");
const ui_contexts_1 = require("@rocket.chat/ui-contexts");
const react_1 = __importDefault(require("react"));
const react_i18next_1 = require("react-i18next");
const outgoingEvents_1 = require("../../../../../../app/integrations/lib/outgoingEvents");
const useFormatDateAndTime_1 = require("../../../../../hooks/useFormatDateAndTime");
const useHighlightedCode_1 = require("../../../../../hooks/useHighlightedCode");
const HistoryItem = ({ data }) => {
    const { t } = (0, react_i18next_1.useTranslation)();
    const replayOutgoingIntegration = (0, ui_contexts_1.useMethod)('replayOutgoingIntegration');
    const { _id, _createdAt, _updatedAt, httpResult, event, step, httpCallData, data: dataSentToTrigger, prepareSentMessage, processSentMessage, url, httpError, errorStack, error, integration: { _id: integrationId }, } = data;
    const createdAt = typeof _createdAt === 'string' ? _createdAt : _createdAt.toISOString();
    const updatedAt = typeof _updatedAt === 'string' ? _updatedAt : _updatedAt.toISOString();
    const handleClickReplay = (0, fuselage_hooks_1.useMutableCallback)((e) => {
        e.stopPropagation();
        replayOutgoingIntegration({ integrationId, historyId: _id });
    });
    const formatDateAndTime = (0, useFormatDateAndTime_1.useFormatDateAndTime)();
    const dataSentToTriggerCode = (0, useHighlightedCode_1.useHighlightedCode)('json', JSON.stringify(dataSentToTrigger || '', null, 2));
    const prepareSentMessageCode = (0, useHighlightedCode_1.useHighlightedCode)('json', JSON.stringify(prepareSentMessage || '', null, 2));
    const processSentMessageCode = (0, useHighlightedCode_1.useHighlightedCode)('json', JSON.stringify(processSentMessage || '', null, 2));
    const httpCallDataCode = (0, useHighlightedCode_1.useHighlightedCode)('json', JSON.stringify(httpCallData || '', null, 2));
    const httpErrorCode = (0, useHighlightedCode_1.useHighlightedCode)('json', JSON.stringify(httpError || '', null, 2));
    const httpResultCode = (0, useHighlightedCode_1.useHighlightedCode)('json', JSON.stringify(httpResult || '', null, 2));
    const errorStackCode = (0, useHighlightedCode_1.useHighlightedCode)('json', JSON.stringify(errorStack || '', null, 2));
    return ((0, jsx_runtime_1.jsx)(fuselage_1.Accordion.Item, { title: (0, jsx_runtime_1.jsxs)(fuselage_1.Box, { display: 'inline-flex', w: 'full', flexDirection: 'row', justifyContent: 'space-between', children: [(0, jsx_runtime_1.jsxs)(fuselage_1.Box, { display: 'flex', flexDirection: 'row', alignItems: 'center', children: [(0, jsx_runtime_1.jsx)(fuselage_1.Icon, { name: 'info-circled', size: 'x16', mie: 4 }), formatDateAndTime(_createdAt)] }), (0, jsx_runtime_1.jsx)(fuselage_1.Button, { secondary: true, onClick: handleClickReplay, children: t('Replay') })] }), children: (0, jsx_runtime_1.jsxs)(fuselage_1.FieldGroup, { children: [(0, jsx_runtime_1.jsxs)(fuselage_1.Field, { children: [(0, jsx_runtime_1.jsx)(fuselage_1.FieldLabel, { children: t('Status') }), (0, jsx_runtime_1.jsx)(fuselage_1.FieldRow, { children: (0, jsx_runtime_1.jsx)(fuselage_1.Box, { withRichContent: true, w: 'full', children: (0, jsx_runtime_1.jsx)("code", { children: error ? t('Failure') : t('Success') }) }) })] }), (0, jsx_runtime_1.jsxs)(fuselage_1.Field, { children: [(0, jsx_runtime_1.jsx)(fuselage_1.FieldLabel, { children: t('Integration_Outgoing_WebHook_History_Time_Triggered') }), (0, jsx_runtime_1.jsx)(fuselage_1.FieldRow, { children: (0, jsx_runtime_1.jsx)(fuselage_1.Box, { withRichContent: true, w: 'full', children: (0, jsx_runtime_1.jsx)("code", { children: createdAt }) }) })] }), (0, jsx_runtime_1.jsxs)(fuselage_1.Field, { children: [(0, jsx_runtime_1.jsx)(fuselage_1.FieldLabel, { children: t('Integration_Outgoing_WebHook_History_Time_Ended_Or_Error') }), (0, jsx_runtime_1.jsx)(fuselage_1.FieldRow, { children: (0, jsx_runtime_1.jsx)(fuselage_1.Box, { withRichContent: true, w: 'full', children: (0, jsx_runtime_1.jsx)("code", { children: updatedAt }) }) })] }), (0, jsx_runtime_1.jsxs)(fuselage_1.Field, { children: [(0, jsx_runtime_1.jsx)(fuselage_1.FieldLabel, { children: t('Event_Trigger') }), (0, jsx_runtime_1.jsx)(fuselage_1.FieldRow, { children: (0, jsx_runtime_1.jsx)(fuselage_1.Box, { withRichContent: true, w: 'full', children: (0, jsx_runtime_1.jsx)("code", { children: t(outgoingEvents_1.outgoingEvents[event].label) }) }) })] }), (0, jsx_runtime_1.jsxs)(fuselage_1.Field, { children: [(0, jsx_runtime_1.jsx)(fuselage_1.FieldLabel, { children: t('Integration_Outgoing_WebHook_History_Trigger_Step') }), (0, jsx_runtime_1.jsx)(fuselage_1.FieldRow, { children: (0, jsx_runtime_1.jsx)(fuselage_1.Box, { withRichContent: true, w: 'full', children: (0, jsx_runtime_1.jsx)("code", { children: step }) }) })] }), dataSentToTrigger && ((0, jsx_runtime_1.jsxs)(fuselage_1.Field, { children: [(0, jsx_runtime_1.jsx)(fuselage_1.FieldLabel, { children: t('Integration_Outgoing_WebHook_History_Data_Passed_To_Trigger') }), (0, jsx_runtime_1.jsx)(fuselage_1.FieldRow, { children: (0, jsx_runtime_1.jsx)(fuselage_1.Box, { withRichContent: true, w: 'full', children: (0, jsx_runtime_1.jsx)("pre", { children: (0, jsx_runtime_1.jsx)("code", { dangerouslySetInnerHTML: { __html: dataSentToTriggerCode } }) }) }) })] })), prepareSentMessage && ((0, jsx_runtime_1.jsxs)(fuselage_1.Field, { children: [(0, jsx_runtime_1.jsx)(fuselage_1.FieldLabel, { children: t('Integration_Outgoing_WebHook_History_Messages_Sent_From_Prepare_Script') }), (0, jsx_runtime_1.jsx)(fuselage_1.FieldRow, { children: (0, jsx_runtime_1.jsx)(fuselage_1.Box, { withRichContent: true, w: 'full', children: (0, jsx_runtime_1.jsx)("pre", { children: (0, jsx_runtime_1.jsx)("code", { dangerouslySetInnerHTML: { __html: prepareSentMessageCode } }) }) }) })] })), processSentMessage && ((0, jsx_runtime_1.jsxs)(fuselage_1.Field, { children: [(0, jsx_runtime_1.jsx)(fuselage_1.FieldLabel, { children: t('Integration_Outgoing_WebHook_History_Messages_Sent_From_Process_Script') }), (0, jsx_runtime_1.jsx)(fuselage_1.FieldRow, { children: (0, jsx_runtime_1.jsx)(fuselage_1.Box, { withRichContent: true, w: 'full', children: (0, jsx_runtime_1.jsx)("pre", { children: (0, jsx_runtime_1.jsx)("code", { dangerouslySetInnerHTML: { __html: processSentMessageCode } }) }) }) })] })), url && ((0, jsx_runtime_1.jsxs)(fuselage_1.Field, { children: [(0, jsx_runtime_1.jsx)(fuselage_1.FieldLabel, { children: t('URL') }), (0, jsx_runtime_1.jsx)(fuselage_1.FieldRow, { children: (0, jsx_runtime_1.jsx)(fuselage_1.Box, { withRichContent: true, w: 'full', children: (0, jsx_runtime_1.jsx)("code", { children: url }) }) })] })), httpCallData && ((0, jsx_runtime_1.jsxs)(fuselage_1.Field, { children: [(0, jsx_runtime_1.jsx)(fuselage_1.FieldLabel, { children: t('Integration_Outgoing_WebHook_History_Data_Passed_To_URL') }), (0, jsx_runtime_1.jsx)(fuselage_1.FieldRow, { children: (0, jsx_runtime_1.jsx)(fuselage_1.Box, { withRichContent: true, w: 'full', children: (0, jsx_runtime_1.jsx)("pre", { children: (0, jsx_runtime_1.jsx)("code", { dangerouslySetInnerHTML: { __html: httpCallDataCode } }) }) }) })] })), httpError && ((0, jsx_runtime_1.jsxs)(fuselage_1.Field, { children: [(0, jsx_runtime_1.jsx)(fuselage_1.FieldLabel, { children: t('Integration_Outgoing_WebHook_History_Http_Response_Error') }), (0, jsx_runtime_1.jsx)(fuselage_1.FieldRow, { children: (0, jsx_runtime_1.jsx)(fuselage_1.Box, { withRichContent: true, w: 'full', children: (0, jsx_runtime_1.jsx)("pre", { children: (0, jsx_runtime_1.jsx)("code", { dangerouslySetInnerHTML: { __html: httpErrorCode } }) }) }) })] })), httpResult && ((0, jsx_runtime_1.jsxs)(fuselage_1.Field, { children: [(0, jsx_runtime_1.jsx)(fuselage_1.FieldLabel, { children: t('Integration_Outgoing_WebHook_History_Http_Response') }), (0, jsx_runtime_1.jsx)(fuselage_1.FieldRow, { children: (0, jsx_runtime_1.jsx)(fuselage_1.Box, { withRichContent: true, w: 'full', children: (0, jsx_runtime_1.jsx)("pre", { children: (0, jsx_runtime_1.jsx)("code", { dangerouslySetInnerHTML: { __html: httpResultCode } }) }) }) })] })), errorStack && ((0, jsx_runtime_1.jsxs)(fuselage_1.Field, { children: [(0, jsx_runtime_1.jsx)(fuselage_1.FieldLabel, { children: t('Integration_Outgoing_WebHook_History_Error_Stacktrace') }), (0, jsx_runtime_1.jsx)(fuselage_1.FieldRow, { children: (0, jsx_runtime_1.jsx)(fuselage_1.Box, { withRichContent: true, w: 'full', children: (0, jsx_runtime_1.jsx)("pre", { children: (0, jsx_runtime_1.jsx)("code", { dangerouslySetInnerHTML: { __html: errorStackCode } }) }) }) })] }))] }) }));
};
exports.default = HistoryItem;
